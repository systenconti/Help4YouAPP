{% extends 'base.html' %}

{% block title %}Help4You{% endblock %}

{% block content %}
<h1>Welcome to Help4You, We're here to help!</h1>
<h3>Type in your address and choose service type to get the best assistance!</h3>
<form method="POST">
    {% csrf_token %}
    <div class="form-group mb-4">
        <label for="first_name">Address:</label>
        <input class="form-control" type="text" id="first_name" name="first_name" required>
    </div>
    <div class="form-group mb-4">
        <label for="last_name">Service:</label>
        <input class="form-control" type="text" id="last_name" name="last_name" required>
    </div>
    <div class="form-group mb-4">
        <label for="email">Email:</label>
        <input class="form-control" type="email" id="email" name="email" required>
    </div>
    <div class="form-group mb-4">
        <label for="mobile">Mobile Number:</label>
        <input class="form-control" type="tel" id="mobile" name="mobile" required>
    </div>
    <div class="form-group mb-4">
        <label for="profession">Specialist:</label>
        <select class="form-control" id="profession" name="profession" required>
            <option value="" disabled selected>Select a specialist...</option>
            {% for profession in professions %}
            <option value="{{ profession.id }}">{{ profession.profession }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group mb-4">
        <label for="service">Service:</label>
        <select class="form-control" id="service" name="service" required>
            <option value="" disabled selected>Select a service...</option>
        </select>
    </div>
    <button class="btn btn-secondary mb-4" type="submit">Submit</button>
</form>
{% endblock %}

{% block js %}
<script>
    function populate_services() {
        var profession_id = $("#profession").val();
        if (profession_id) {
            $.ajax({
                url: "/get_services/" + profession_id + "/",
                type: "GET",
                dataType: "json",
                success: function(data) {
                    $("#service").empty();
                    $("#service").append('<option value="" disabled selected>Select a service...</option>');
                    $.each(data.services, function(index, service) {
                        $("#service").append('<option value="' + service.id + '">' + service.service + '</option>');
                    });
                }
            });
        } else {
            $("#service").empty();
            $("#service").append('<option value="" disabled selected>Select a service...</option>');
        }
    }

    $(document).ready(function() {
        populate_services();
        $("#profession").change(function() {
            populate_services();
        });
    });
</script>
{% endblock %}